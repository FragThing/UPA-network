# 联合容器网络：一种全新的计算资源共享方式

version: 0.1

因本网络设计复杂，本白皮书主要探讨本项目的*必要性*与*可行性*，技术设计将在黄皮书中进行详细解释。

# 容器化技术

容器化是指将软件代码和所需的所有组件（例如库、框架和其他依赖项）打包在一起，让它们隔离在自己的"容器"中。
这样，容器内的软件或应用就可以在任何环境和任何基础架构上一致地移动和运行，不受该环境或基础架构的操作系统影响。容器就像是一个气泡（或者是应用周围的计算环境），把应用和周围环境隔离开来。它相当于是一个功能全面、便于移植的计算环境。

目前市场上有podman 或 docker，lxc 或者其他基于这些的平台，它们都旨在提供一个与宿主无关的隔离的环境。但与虚拟机相似的是，一般来说，人们的使用方式依然被固定在像虚拟机一样的运行它们。另外来说，从云服务商的计价方式与管理来说，与传统的只运行一个主要应用的虚拟机无异，主要以算力与使用时间为定义。
有些平台支持动态拓展的功能，例如 Kubernetes，但必须依赖一个提前编排好的需要专业运维人员的配置文件或者手动进行设置，且在实际使用时与云运营商强绑定。
所以，很明显的，容器与它相关的技术并没有真正的解决用户真正的需求，即只在需要的时候为计算资源付费。但比虚拟机更好的是，现在用户至少不需要为不需要对支持系统本身运行的程序付费或者维护了。

因此，容器化技术已经向我们证明了，在任意平台上运行不限语言的任意的相同程序的可能。


# 以太坊

以太坊（Ethereum）是一个去中心化的开源的有智能合约功能的公共区块链平台。以太币（ETH 或 Ξ）是以太坊的原生加密货币。以太坊的概念首次在2013至2014年间由程序员维塔利克·布特林受比特币启发后提出，大意为“下一代加密货币与去中心化应用平台”。

## 优势

显然的，以太坊想要解决的主要问题是，比特币所留下的，对于执行任意脚本的需求。同样，比特币也有可以自动运行的交易规则，被用于多重验证，自动转账等方面，被称为“智能合约”。但比特币因为缺少以太坊中为运算资源付费的 gas 的概念，而选择不实现循环等可能导致无限循环的语言结构。因此，从现实角度来看，比特币语言的图灵完备是简陋而局限的。以太坊通过 gas 巧妙解决了上述问题，因此也出现了所谓的 Dapp：一个用户交互的 web 页面与背后的智能合约。
因此，以太坊在现实意义上，真正的实现了一个完整的虚拟计算机系统。

## 缺陷

但因其基于单条区块链的账本模式，这个计算系统实际共用一个全局的运行锁，严重限制了计算效率。在实际运行中，以太坊的一层网络的交易处理速度仅为 [15 笔每秒](https://ethtps.info/Network/Ethereum)，为了解决该问题，以太坊事实上以“代理”的方式是用一种不可持续的“打补丁”的形式解决，即[二层网络]((https://ethereum.org/zh/layer-2/))。
以太坊二层网络是为了实现高速交易（也可以视作运算）而被发明的一种基于一层网络的可信性而运行的网络，它主要基于“可信的卷叠商”的服务。卷叠商负责压缩交易并发送到一层网络上，以一定的中心化解决交易速度的问题。卷叠分为“乐观卷叠”与“零知识卷叠”，本身都支持且必须支持数据校验。但这也带来两点问题：1. 与系统主旨完全违背的中心化问题，目前看来并没有某个巨头垄断，但其本质并不是这种形式能够抵御中心化，而是目前的市场相对处于萌芽阶段；2. 任意卷叠商上报了错误的交易数据会直接给整个以太坊网络带来巨大的数据校验的运算压力与不可避免的账本回滚导致的运算压力，前者乐观的来说，只是会短暂的减缓网络速度，而后者则对于某些与实体商品相关的交易是几乎毁灭性的打击，因为商品交付行为本身无法被“撤回”。
因为二层网络的局限性，以太坊还设计了[分片](https://ethereum.org/zh/upgrades/sharding/)，用于提升以太坊存储和访问数据的能力，但不会用于执行代码。可以说是该文档所描述的网络的简化版本，但未能解决账户信息处理的速度。

此外，以太坊不能运行任意程序。基于 EVM 也意味着，如果希望移植现有应用到以太坊。我们需要完整发明整个互联网与应用框架，即：1. 网络数据传输（tcp/ip） 2. 访问运行在网络上的应用的专用软件或者完整的 web 兼容层 3. 基于以太坊虚拟机语言的应用框架 4. 用以太坊虚拟机可以用的语言重写原有程序。
因此，显而易见的，无论是全新开始的初创企业还是拥有大量现有应用的大型企业，对于人力或者时间成本，这几乎都是不可能的任务。而这也是为什么以太坊宣称自己图灵完备，却又几乎无人使用它成功在金融以外的领域盈利。

# 联合容器网络

因此，显而易见的，我们可以提出网络，它至少应该拥有以下特性：1. 可以运行任意程序，不应该与虚拟货币强关联 2. 与现有 web 世界或者各类区块链应用兼容的 3. 天生具有计算性能的拓展性，即拥有动态的性能拓展性。
我将其称作“联合容器网络”，意指：多个自发接入网络的宿主机*联合*组成了一个可以运行*容器*的以虚拟货币驱动的运算*网络*。

## 主要功能特点

为了解决以太坊的局限性，这个网络应该拥有以下功能：
1. 与现有的互联网或其他技术兼容（容器化）
2. 整个网络（包括帐号信息）不会运行在单一区块链上，以此来支持动态扩容，避免全局锁
3. 鼓励区块链之间的合并或部分合并，防止网络出现大范围的完全分支（比如 ETH 与 ETC 的情况）
4. 不限制计算时间，现有的区块链所需要协调的 TPS。其本质原因是计算时间完全由区块发布时间操控，即网络中应用每一次的运行时间不能超过区块发布时间，而这并不符合普遍的计算机使用方式

## 代币系统

显然，现有的虚拟货币网络已经证明了以太坊或者比特币类型的代币完全可以胜任智能合约。因此，在这里我们可以沿用以太坊的方式对代币进行定义，一个类似于积分，一种用编程的方式定义，与现实货币没有强的价格绑定的代币。
但是，对于代币信息的处理方式，与以太坊有很大的不同。因为对以太坊或者比特币而言，帐号或者代币本身，已然成为事实上的全局锁。对于这个锁，它们都选择二层网络的补丁方式掩盖，而并无法在根本上解决问题。这是因为设计使然。
因此，在联合容器网络中，我们采用类似现实世界中银行开设分行，同时存在不同银行的方式来理解并解决代币帐号拓展性的问题。

为了实现本网络的功能，这个代币系统的设计主要如下：
1. 不与编程语言绑定，即不需要特殊语言来操作账户信息
2. 能够主动的持续驱动网络运行，类似于以太坊和比特币的挖矿奖励，鼓励节点在空负载下也保持在线
3. 能够在多个链之间交互，不需要桥的额外实现

### 挖矿

挖矿（英语：Mining），是指透过执行工作量证明或其他类似的电脑演算法来获取加密货币，例如比特币、以太币、莱特币等。由于此名称源自对采矿的比喻，进行挖矿工作的人通常称为矿工。 
作为一种可以自行驱动虚拟货币网络运行的方式，挖矿是几乎每个虚拟货币的标配。

这里的挖矿暂定为两种方式：
1. 用户支付矿工费购买网络的计算资源。类似以太坊的燃料费，如果希望在本网络上运行程序，就必须要标明运行程序所愿意支出的代币数量。不同的是，用户需要在程序发布到网络上时同步质押这些代币。 挖矿者可以用各种方式证明自己完成了任务，然后获得这些代币。
代币发放的规则为：1. 矿工可以按照运行时长或与其他计算资源（例如 CPU 占用、网络带宽、磁盘占用等）进行加权收费 2. 用户可以限制矿工收费的速率与最高费用 3. 矿工可以选择自己感兴趣（收益较高）的程序运行来获取矿工费。
2. 网络通过规则生成矿工费为积极传播节点间的网络信息充当网关的矿工付费。类似于以太坊生成区块的奖励，但奖励不是固定，而是按照实际传输的数据贡献来获取矿工费。

### 帐号信息存储

以太坊或其他加密货币对待账户的方式是全局的账本，这意味着无论如何优化这个账本的数据结构，账本都一定会成为一个全局锁，当不同节点选择了不同的交易处理，那么最后的账本一定出现无法协调的不一致，并迫使某一方放弃交易结果并同步其他节点的账本信息。

为了避免因此而导致的性能问题，我们鼓励用户自行分支主链并完全运行在支链上，并定期（或在必要时）压缩合并（所有或部分）支链信息到主链。
为简化帐号模型，支链的帐号信息存储结构与主链完全一致，唯一区别是用于区分链的唯一 ID。主链 ID 衡为 “main”，支链的 ID 由 UUID 生成（通过对特定用于记录支链信息的帐号转账的方式，作为交易信息内容发布到主链，手续费为本网络代币的最小面额）。
同时本系统参考以太坊 GHOST 协议，鼓励用户合并支链信息到主链。如果在一定区块时间内通过质押的方式，合并支链信息，则可以得到奖励，该奖励随时间递减。

## 链

受现实中银行系统的启发。本网络通过灵活的链操作，将一个全局的账本拆分成多个分账本，即主链与支链。两者在代码实现上完全一致，可以互相合并与分支，都拥有网络的所有功能。

### 主链

主链参考 ETH 设计，具体实现完全与支链相同，为该网络上线的第一个节点的创世区块创建。事实上，主链只是一个拥有特殊 ID 的支链。此外，我们只会监控与维护主链。
此外，与支链不同的是，当主链受到攻击且攻击成功时，我们会发起社区投票进行对主链的攻击的节点分叉。

### 支链

支链是本网络对于*区块链桥*的一种更加原生态的实现方式。通过将不同账本的合并与分支作为账户操作的底层，我们可以在拥有高性能与高拓展性的优势的同时，避免区块链桥因代码实现不同而易受攻击的问题。
当支链受到攻击且攻击成功时，我们只会禁止被攻击后的结果合并到主链或其他链，具体解决方案由支链维护者决定。

### 中心化支持

为避免 The DAO 事件，本网络拥有中心化支持：

+ 函数可以标记自己拥有独裁者账户（管理员）或管理员签名
+ 函数可以标记参与者投票来撤销整个函数
    1. 发起函数需指明百分比为多少
+ 函数可以标记自己是可以被持有相同签名的函数覆盖的
    1. 发起函数需要标记每次更新后等待多少个区块或多久的现实时间
    2. 参与的账户在加入时可以选择是否跟随升级
    3. 每个升级完成后将等待时间中，已升级的账户可以选择回滚到任意版本
    4. 未升级的账户可以随时升级

### 合并

合并是链之间的主要操作，节点通过使用一定金额或信用担保合并进入其他链的方式来进行合并。它本身是一种交易行为，即在被合并的链上进行代币销毁在合并的目标链上进行代币生成。具体实现方式参考 ETH 的[乐观卷叠](https://ethereum.org/zh/developers/docs/scaling/optimistic-rollups/)与[零知识卷叠](https://ethereum.org/zh/developers/docs/scaling/zk-rollups)。
如果被发现合并请求存在欺诈行为，则罚没全部保证金或按合并涉及的金额扣除信用。

## 信用

信用是参考 ETH 的权威证明的一种使用方式，可以被用作链操作的担保，例如合并操作。
账户可以通过交易、挖矿、合并等行为为自己积累信用。此外信用也可以使用一定数量代币担保的行为直接增加信用，若选择取消这些担保的代币，则直接取消增加的信用。

## 运行时

运行时在这里的定义是：开发者可以在其中运行自己的代码并操作本网络。
为了实现可编程，ETH 与 BTC 都有自己的运行时，而不同于这两者或其他区块链，本网络的运行时是一个基于 podman 的容器化环境。
与 ETH 或 BTC 不同，可编程代币的形式并不由特定语言实现，受 Linux 操作系统的启发，运行在该环境中的程序可以通过用 fuse 文件系统提供的 API 来操作本网络。
基于平台开发的开发者只需要像使用 docker 或 podman 一样，关注容器本身，与容器内在根目录下的 API 目录，并在需要时通过它们来操作链（分支/合并）、操作帐号（转账）、设置运行时（定时运行/销毁）、发布新任务等。

### 运行时类型

通过运行条件与是否暂停容器，我们大概分为以下类型：
1. 按单次运行付费的容器
2. 永远运行，按照消耗计算资源计费的容器（传统运行容器的方式）

### 运行条件

与 ETH 运行合约的形式不同，本系统提供了大量基于目前现实中切实存在的调用形式来激活运行时，如下：
1. 通过网络调用，例如通过 tcp/ip 协议访问服务。网络会自动唤醒响应容器并等待容器响应完成，
2. 通过定时任务，用户可以设置定时器任务，指定循环运行、单次指定下次运行时间

### 暂停容器

1. 通过对 API 文件夹下虚拟文件操作调用 API
2. 为了方便旧有项目或者不会编程/不容易操作原代码的用户使用本系统，系统也会自动识别终端输出里的特殊“检查点”来暂停容器

## 网络

我们认为网络是区块链的基石，为了实现节点的加入退出的简易性，并保持对现有互联网体系的兼容，我们目前不会考虑基于 libp2p 等 p2p 代码库来自行实现一种协议来转发数据。
反而，我们认为一个可以动态运行，没有中心节点的 VPN 是为之可行的方案，对于开发成本来说，我们从现有的项目中选择认为 [dn42](https://dn42.eu/) 将会成为本项目的网络层。

# 应用

与 ETH 不同，本网络会实现网络基础的架构，以避免设计不佳的应用占用大量资源。例如：DNS、文件存储、消息传递等。

## DNS

分布式 DNS 在 P2P 的应用非常广泛，其根本原因是它是几乎一切计算机网络的基石部分，而DNS 在区块链中最出名的则是域名币。
域名币毋庸置疑开创了一个新的且有效的 DNS 实现方案，但 2015 年的一项研究发现，在 Namecoin 上注册的 120,000 个域名中，只有 28 个在使用中。这也体现了其设计的荒谬性——无法被注销。
因此，本网络实现的标准 DNS 实现参考现有的域名注册商的服务。用户可以质押一部分代币来获得一个未被占用的域名，每当出现一次解析请求时，从质押的代币中支出一部分服务费给响应解析结果的节点（但是在短时间内进行的多次解析不会多次扣费，避免恶意解析带来的巨额费用）。此外，为了维持域名持有，网络也会自动按照时间，衡速销毁质押的代币，当代币被消耗殆尽时，域名被释放。用户也可以随时选择取出或充值代币为质押代币。

## 文件存储

参考本网络的 DNS 实现与 [ETH 的去中心化文件存储](https://ethereum.org/zh/whitepaper/#decentralized-file-storage)，该系统使用所谓的**微交易通道协议**（本系统中没有实现，因为支链已经能够实现它快速交易的目的）
即，通过不断的支付微额代币来保证永远有多个节点同时持有文件，当用户真的大量请求数据时，再按照提前的代码约定来判断是请求方还是存储方支付数据存储/传输费用（一般来说，为了避免滥用或 DDoS 攻击，我们可以参考 Mega 网盘服务，存储方提供有限的请求额度，超过额度需要请求方为此付费）。

## 消息传递

消息传递框架旨在快速的在网络内实现一个通知系统用于支持基于网络的应用开发，例如论坛、IM等
鉴于消息传递的即时性，该框架将在支链运行。此外，为了保证框架的运行速度，官方不会提供保证时延的服务平台，而是希望开发者对于自己的应用在需要时*自动*通过代码调用 API 创建专用于对应应用的支链运行该框架来改善时延。

